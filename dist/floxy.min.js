var floxy=function(t){"use strict";class e{constructor({name:t}){if(new.target===e)throw new TypeError("Cannot construct Component instances directly");this.name=t,this.containerID=this.name?this.name.toLowerCase().replace(/\s+/g,"-"):`tab-${Math.random().toString(36).substring(2,15)}`,this.id=this.containerID,this.container=null,this.created=!1,this.rendered=!1,this.parentContainer=null,this.onlyChild=null}renderInto(t,e=!1){let n;if(this.onlyChild=e,this.isRendered())console.warn(`'${this.name}' component is already rendered.`);else{if("string"==typeof t){if(n=document.getElementById(t),!n)throw new Error(`Container with id ${t} not found`)}else{if(!(t instanceof HTMLElement))throw new Error("Container must be a valid HTMLElement or a string ID.");n=t}if(!n.id)throw new Error("Container must have a valid id.");this.parentContainer=n,this.createContainer(),this.onlyChild?this.parentContainer.replaceChildren(this.container):this.parentContainer.appendChild(this.container),console.log("DOM is rendered into container ",n.id),this.rendered=!0}}getParentContainer(){return this.rendered?this.parentContainer:(console.warn(`'${this.name}' component is not rendered yet.`),null)}createContainer(){return this.isCreated()?this.container?this.container:void console.warn(`${this.component} component is already rendered.`):(this.container=this.#t(),this.initContainer(),this.container)}getContainer(){return this.container||this.createContainer(),this.container}#t(){const t=document.createElement("div");t.id=this.containerID,t.style.height="100%",t.style.width="100%";const e=this.html();return t.insertAdjacentHTML("beforeend",e),t}initContainer(){this.init(),this.created=!0}isCreated(){return this.created}isRendered(){return this.rendered}init(){throw new Error("Method 'init()' must be implemented in the subclass")}html(){throw new Error("Method '#html()' must be implemented in the subclass")}}class n extends e{constructor({name:t}){super({name:t}),this.events={}}on(t,e){(this.events[t]||=[]).push(e)}emit(t,e){(this.events[t]||[]).forEach(t=>t(e))}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(t=>t!==e))}clear(t){t?delete this.events[t]:this.events={}}}class o{constructor(t,e,n={x:0,y:0},o={x:0,y:0},i=1){this.element=t,this.onMoveHandler=e,this.zoomGetter="function"==typeof i?i:()=>i,this.isDragging=!1,this.dragStartPosition=o,this.initialPosition=n,this.elementX=this.initialPosition.x,this.elementY=this.initialPosition.y,this.rafId=null,this.MOUSE_RIGHT_CLICK=2}destroy(){this.element.removeEventListener("mousedown",this.onHold.bind(this)),window.removeEventListener("mousemove",this.onMove.bind(this)),window.removeEventListener("mouseup",this.onRelease.bind(this))}registerDragEvent(){this.element.addEventListener("mousedown",this.onHold.bind(this))}onHold(t){t.button!==this.MOUSE_RIGHT_CLICK?(t.stopPropagation(),this.isDragging=!0,this.dragStartPosition={x:t.clientX,y:t.clientY},this.initialPosition={x:this.elementX,y:this.elementY},this.element.style.cursor="grabbing",window.addEventListener("mousemove",this.onMove.bind(this)),window.addEventListener("mouseup",this.onRelease.bind(this)),this.startRaf()):console.debug("FLOW: Ignoreing Right click on ",this.element)}onMove(t){if(t.button===this.MOUSE_RIGHT_CLICK)return void console.debug("FLOW: Ignoreing Right click on",this.element);if(t.stopPropagation(),!this.isDragging)return;const e=this.zoomGetter(),n=(t.clientX-this.dragStartPosition.x)/e,o=(t.clientY-this.dragStartPosition.y)/e;this.elementX=this.initialPosition.x+n,this.elementY=this.initialPosition.y+o}onRelease(t){t.button!==this.MOUSE_RIGHT_CLICK?(t.stopPropagation(),this.isDragging=!1,this.element.style.cursor="grab",window.removeEventListener("mousemove",this.onMove.bind(this)),window.removeEventListener("mouseup",this.onRelease.bind(this))):console.debug("FLOW: Ignoreing right click on",this.element)}static register(t,e,n=1){const i=new o(t,e,{x:0,y:0},{x:0,y:0},n);return i.registerDragEvent(),i}startRaf(){if(this.rafId)return;const t=()=>{if(!this.isDragging)return cancelAnimationFrame(this.rafId),void(this.rafId=null);this.onMoveHandler(this.elementX,this.elementY),this.rafId=requestAnimationFrame(t)};this.rafId=requestAnimationFrame(t)}}class i extends n{constructor({name:t,options:e={}}){super({name:t}),this.options=e,this.zoom=e.zoom||1,this.enableZoomActions=e.enable_zoom_actions||!0,this.originalZoom=this.zoom,this.canvasX=e.canvas?.x||0,this.canvasY=e.canvas?.y||0,this.canvasId=this.id+"-canvas",this.containerId=this.id+"-flow-container",this.zoomActionsId=this.id+"-zoom-actions"}html(){return`\n            <div id="${this.canvasId}" \n                class="flow-canvas" \n                style="transform: translate(${this.canvasX}px, ${this.canvasY}px) scale(${this.zoom})">\n                <svg id="${this.id}-svg" class="flow-connections"></svg>\n            </div>\n            ${this.enableZoomActions?`<div id="${this.zoomActionsId}" class="zoom-actions"></div>`:""}\n        `}init(){this.containerEl=this.parentContainer,this.canvasEl=this.container.querySelector(`#${this.canvasId}`),this.svgEl=this.container.querySelector(`#${this.id}-svg`),this.container=this.canvasEl,o.register(this.containerEl,this.redrawCanvasWithXY.bind(this)),this.enableZoomActions&&this.containerEl.addEventListener("wheel",this.onCanvasWheelZoom.bind(this),{passive:!1}),this.containerEl.addEventListener("dragover",t=>t.preventDefault()),this.containerEl.addEventListener("drop",this.onDrop.bind(this))}redrawCanvas(){this.redrawCanvasWithXY(this.canvasX,this.canvasY)}redrawCanvasWithXY(t,e){this.canvasX=t,this.canvasY=e,this.canvasEl.style.transform=`translate(${t}px, ${e}px) scale(${this.zoom})`;const n=this.gridFactor*this.zoom;this.containerEl.style.backgroundSize=`${n}px ${n}px`,this.containerEl.style.backgroundPosition=`${t}px ${e}px`,this.containerEl.style.backgroundImage=`radial-gradient(#c1c1c4 ${1.5*this.zoom}px, transparent ${1.5*this.zoom}px)`}onCanvasWheelZoom(t){t.preventDefault(),console.log("FLOW: Wheel on canvas with deltaY: ",t.deltaY);const e=t.deltaY>0?-.1:.1,n=Math.max(.1,Math.min(this.zoom+e,3));this.zoom=n,this.redrawCanvas(),this.emit("canvas:zoom",{data:{zoom:this.zoom,x:this.canvasX,y:this.canvasY,delta:e,originalZoom:this.originalZoom}})}onDrop(t){t.preventDefault(),t.stopPropagation();try{const e=t.dataTransfer.getData("application/json");if(!e)return;const n=JSON.parse(e),o=this.containerEl.getBoundingClientRect(),i=t.clientX-o.left-this.canvasX,s=t.clientY-o.top-this.canvasY;this.emit("node:dropped",{data:{x:i,y:s,...n}}),console.debug("FLOW - DROP: ",n,i,s)}catch(t){console.error("Invalid drop data",t)}}}const s="node:moved",a="node:removed",d="connection:created",r="connection:removed",c="connection:clicked";class h extends n{constructor({name:t,canvasContainer:e,options:n={}}){super({name:t+"-flow-node-manager"}),this.options=n,this.zoom=n.zoom||1,this.originalZoom=this.zoom,this.nodes={},this.nodeIdCounter=1,this.nodeWidth=n.nodeWidth||200,this.nodeHeight=n.nodeHeight||90,this.selectedNodeId=null,this.canvasContainer=e}dropNode(t){const e=(t.x-this.nodeWidth/2)/this.zoom,n=(t.y-this.nodeHeight/2)/this.zoom;this.addNode({...t,x:e,y:n})}addNode({name:t,inputs:e=1,outputs:n=1,x:o=0,y:i=0,html:s=""}){const a=this.nodeIdCounter++,d={id:a,name:t,inputs:e,outputs:n,x:o,y:i,contentHtml:s};return this.nodes[a]=d,this.renderNode(d),a}renderNode(t){const e=document.createElement("div"),n=`<div class="flow-port" data-type="input" data-node-id="${t.id}" data-index="{{index}}"></div>`,i=`<div class="flow-port" data-type="output" data-node-id="${t.id}" data-index="{{index}}"></div>`,s=`\n        <div id="node-${t.id}" \n            data-id="${t.id}" \n            class="flow-node rounded" \n            style="top: ${t.y}px; left: ${t.x}px; \n                    width: ${this.nodeWidth}px; height: fit-content">                        \n            <div class="flow-ports-column flow-ports-in">\n                ${Array.from({length:t.inputs},(t,e)=>n.replace("{{index}}",e)).join("\n")}\n            </div>\n            <div class="flow-node-content card w-100">              \n              <div class="card-header">${t.name}</div>\n              <div class="card-body">${t.contentHtml}</div>              \n            </div>            \n            <div class="flow-ports-column flow-ports-out">                \n                ${Array.from({length:t.outputs},(t,e)=>i.replace("{{index}}",e)).join("\n")}\n            </div>\n            <button type="button" \n                data-id="${t.id}"\n                class="btn-danger btn-close node-close border rounded shadow-none m-1" \n                aria-label="Close">\n            </button>\n        </div>\n        `;e.innerHTML=s;const a=e.querySelector(`#node-${t.id}`);a.onclick=e=>this.onNodeClick(e,t.id),a.onmousedown=e=>this.onNodeClick(e,t.id);new o(a,this.redrawNodeWithXY.bind(this,t.id),{x:this.nodes[t.id].x,y:this.nodes[t.id].y},{x:0,y:0},()=>this.zoom).registerDragEvent(),a.querySelector("button.node-close").addEventListener("click",e=>this.removeNode(e,t.id)),a.querySelectorAll(".flow-ports-out .flow-port").forEach(e=>{e.onmousedown=n=>{this.emit("port:connect:start",{nodeId:t.id,portIndex:e.dataset.index,event:n})}}),a.querySelectorAll(".flow-ports-in .flow-port").forEach(e=>{e.onmouseup=n=>{this.emit("port:connect:end",{nodeId:t.id,portIndex:e.dataset.index,event:n})}}),this.nodes[t.id].el=a,this.canvasContainer.appendChild(a)}reset(){Object.values(this.nodes).forEach(t=>{t.el?.remove()}),this.nodes={},this.nodeIdCounter=1,this.selectedNodeId=null}redrawNodeWithXY(t,e,n){this.nodes[t].x=e,this.nodes[t].y=n,this.nodes[t].el.style.top=`${n}px`,this.nodes[t].el.style.left=`${e}px`,this.emit(s,{id:t,x:e,y:n})}onNodeClick(t,e){this.selectedNodeId&&this.nodes[this.selectedNodeId]&&this.nodes[this.selectedNodeId].el.classList.remove("selected"),this.nodes[e].el.classList.add("selected"),this.selectedNodeId=e}removeNode(t,e){console.debug("FLOW: removing node ",e),t.stopPropagation();const n=parseInt(e);this.emit(a,{id:n}),this.nodes[e].el.remove(),delete this.nodes[e]}}class l extends n{constructor({name:t,connectionContainer:e,nodeManager:n,options:o={}}){super({name:t+"-flow-connection-manager",options:o}),this.connectionContainer=e,this.nodeManager=n,this.options=o,this.zoom=o.zoom||1,this.originalZoom=this.zoom,this.nodes=this.nodeManager.nodes,this.nodeIdCounter=1,this.nodeWidth=o.nodeWidth||200,this.nodeHeight=o.nodeHeight||90,this.connections=[],this.pathMap=new Map,this.tempPath=null,this.badPaths=new Set,this.tempSource=null}addConnection(t,e,n,o){const i=parseInt(t),s=parseInt(n),a=parseInt(e),r=parseInt(o);if(this.connections.some(t=>t.outNodeId===i&&t.outPort===a&&t.inNodeId===s&&t.inPort===r))return;const c={outNodeId:i,outPort:a,inNodeId:s,inPort:r};return this.connections.push(c),this.createConnectionPath(c),this.emit(d,c),!0}reset(){this.connections=[],this.pathMap.forEach(t=>t.remove()),this.pathMap.clear(),this.clearTempPath?.()}getConnectionKey(t){return`${t.outNodeId}:${t.outPort}-${t.inNodeId}:${t.inPort}`}createConnectionPath(t){const e=this.getConnectionKey(t),n=this.getPortPosition(t.outNodeId,"output",t.outPort),o=this.getPortPosition(t.inNodeId,"input",t.inPort),i=document.createElementNS("http://www.w3.org/2000/svg","path"),s=this.getBazierPath(n.x,n.y,o.x,o.y);i.setAttribute("d",s),i.setAttribute("class","flow-connection-path"),i.dataset.id=e,i.onclick=e=>{e.stopPropagation(),this.emit(c,t)},this.connectionContainer.appendChild(i),this.pathMap.set(e,i)}updateConnections(t){const e=parseInt(t);this.connections.filter(t=>t.outNodeId===e||t.inNodeId===e).forEach(t=>{const e=this.getConnectionKey(t),n=this.pathMap.get(e);if(!n)return;const o=this.getPortPosition(t.outNodeId,"output",t.outPort),i=this.getPortPosition(t.inNodeId,"input",t.inPort),s=this.getBazierPath(o.x,o.y,i.x,i.y);n.setAttribute("d",s),this.emit("connection:updated",t)})}removeConnection(t){const e=this.getConnectionKey(t),n=this.pathMap.get(e);n&&(n.remove(),this.pathMap.delete(e)),this.connections=this.connections.filter(e=>e!==t),this.emit(r,t)}removeRelatedConnections(t){this.connections.filter(e=>e.outNodeId===t||e.inNodeId===t).forEach(t=>{this.removeConnection(t)})}getPortPosition(t,e,n){const o=this.nodes[t];if(!o||!o.el)return{x:0,y:0};const i=o.el.querySelector(`.flow-port[data-type="${e}"][data-index="${n}"]`);if(!i)return{x:o.x,y:o.y};const s=i.getBoundingClientRect(),a=o.el.getBoundingClientRect(),d=(s.left-a.left+s.width/2)/this.zoom,r=(s.top-a.top+s.height/2)/this.zoom;return{x:o.x+d,y:o.y+r}}getBazierPath(t,e,n,o){return`M ${t} ${e} C ${t+.5*Math.abs(n-t)} ${e} ${n-.5*Math.abs(n-t)} ${o} ${n} ${o}`}beginTempConnection(t,e){this.tempSource={nodeId:t,portIndex:e}}endTempConnection(){this.tempSource=null,this.clearTempPath()}updateTempConnection(t,e){if(!this.tempSource)return;const{nodeId:n,portIndex:o}=this.tempSource,i=this.getPortPosition(n,"output",o);this.createTempPath(i,{x:t,y:e})}createTempPath(t,e){if(this.tempPath)this.clearBadPaths();else{const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("class","flow-connection-path selected flow-connection-temp"),t.style.pointerEvents="none",this.connectionContainer.appendChild(t),this.tempPath=t}const n=this.getBazierPath(t.x,t.y,e.x,e.y);this.tempPath.setAttribute("d",n)}clearTempPath(){this.tempPath&&(this.tempPath.remove(),this.tempPath=null),this.clearBadPaths()}markPathBad(t){this.markTempPathBad(),this.markExistingPathBad(t)}markTempPathBad(){this.tempPath&&(this.tempPath.classList.add("flow-connection-path-bad"),this.badPaths.add(this.tempPath))}markExistingPathBad(t){const e=this.getConnectionKey(t),n=this.pathMap.get(e);n&&(n.classList.add("flow-connection-path-bad"),this.badPaths.add(n))}clearBadPaths(){this.badPaths.forEach(t=>{t.classList.remove("flow-connection-path-bad")}),this.badPaths.clear()}}class m{export(t){const e=t.nodeManager,n=t.connectionManager,o=t.canvas;return{nodes:Object.values(e.nodes).map(({el:t,node:e,...n})=>({id:n.id,name:n.name,inputs:n.inputs,outputs:n.outputs,x:n.x,y:n.y,html:n.html})),connections:n.connections.map(t=>({outNodeId:t.outNodeId,outPort:t.outPort,inNodeId:t.inNodeId,inPort:t.inPort})),zoom:o.zoom,canvas:{x:o.canvasX,y:o.canvasY}}}import(t,e){const{nodeManager:n,connectionManager:o,canvas:i}=t,s=e.zoom||1;t.zoom=s,i.zoom=s,n.zoom=s,o.zoom=s,i.canvasX=e.canvas?.x||0,i.canvasY=e.canvas?.y||0,i.redrawCanvas(),n.reset?.(),o.reset?.(),e.nodes&&e.nodes.forEach(t=>{n.addNode(t)}),e.connections&&e.connections.forEach(e=>{t.addConnection(e.outNodeId,e.outPort,e.inNodeId,e.inPort)})}}class p{onConnectionAttempt({outNodeId:t,inNodeId:e}){return{valid:!0}}onConnectionAdded({outNodeId:t,inNodeId:e}){}onConnectionRemoved({outNodeId:t,inNodeId:e}){}}return t.DagValidator=class extends p{constructor({enabled:t=!0}={}){super(),this.enabled=t,this.adjacencyList={},this.nonCyclicCache={},this.tempCyclicCache={},this.tempStackCache={}}onConnectionAttempt({outNodeId:t,inNodeId:e}){const n="This connection will create cyclic flow.";if(!this.enabled)return{valid:!0};const o=`${t}->${e}`;if(void 0!==this.nonCyclicCache[o])return{valid:!this.nonCyclicCache[o]};if(this.tempCyclicCache[o])return{valid:!1,stack:this.tempStackCache[o],message:n};this.tempStackCache[o]=[];const i=this.tempStackCache[o],s=new Set;let a=new Set(this.adjacencyList[t]||new Set);a.add(e),s.add(t),i.push(t);for(const t of a)if(this.#e(t,s,i))return this.tempCyclicCache[o]=!0,{valid:!1,stack:i,message:n};return{valid:!0}}onConnectionAdded({outNodeId:t,inNodeId:e}){this.#n(t,e),this.#o(t,e)}onConnectionRemoved({outNodeId:t,inNodeId:e}){const n=`${t}->${e}`;this.adjacencyList[t]?.delete(e),delete this.nonCyclicCache[n],this.tempCyclicCache={}}#n(t,e){this.adjacencyList[t]||(this.adjacencyList[t]=new Set),this.adjacencyList[t].add(e)}#o(t,e){const n=`${t}->${e}`;this.nonCyclicCache[n]=!1,delete this.tempStackCache[n]}#e(t,e,n){if(n.includes(t))return n.push(t),!0;if(e.has(t))return!1;e.add(t),n.push(t);for(const o of this.adjacencyList[t]||[])if(this.#e(o,e,n))return!0;return n.pop(),!1}},t.Flow=class extends n{constructor({name:t,options:e={},validators:n=[],notification:o=null}){super({name:t}),this.options=e,this.validators=n,this.notification=o,this.serializer=new m,this.zoom=e.zoom||1,this.originalZoom=this.zoom,this.nodes={},this.nodeIdCounter=1,this.canvasEl=null,this.svgEl=null,this.nodeManager=null,this.connectionManager=null,this.rafId=null,this.isConnecting=!1}html(){return""}init(){this.container.classList.add("floxy-flow-container"),this.canvas=new i({name:this.name+"-canvas",options:this.options}),this.canvas.renderInto(this.container),this.containerEl=this.container,this.canvasEl=this.canvas.canvasEl,this.svgEl=this.canvas.svgEl,this.nodeManager=new h({name:this.name+"-flow-node-manager",canvasContainer:this.canvasEl,options:this.options}),this.connectionManager=new l({name:this.name+"-flow-connection-manager",connectionContainer:this.svgEl,nodeManager:this.nodeManager,options:this.options}),this.canvas.on("canvas:zoom",({data:t})=>{this.zoom=t.zoom,this.connectionManager.zoom=t.zoom,this.nodeManager.zoom=t.zoom}),this.canvas.on("node:dropped",({data:t})=>{console.debug("Node is dropped: ",t),this.emit("node:dropped",t),this.nodeManager.dropNode(t)}),this.nodeManager.on(s,({id:t,x:e,y:n})=>{console.debug("Node is moved: ",t,e,n),this.emit(s,{id:t,x:e,y:n}),this.connectionManager.updateConnections(t)}),this.nodeManager.on(a,({id:t})=>{console.debug("Node is removed: ",t),this.emit(a,{id:t}),this.removeNode(t)}),this.nodeManager.on("port:connect:start",({nodeId:t,portIndex:e,event:n})=>{this.mouseDownStartConnection({dataset:{index:e}},t,n)}),this.nodeManager.on("port:connect:end",({nodeId:t,portIndex:e,event:n})=>{this.mouseUpCompleteConnection({dataset:{index:e}},t,n)}),this.connectionManager.on(d,t=>{console.debug("Connection is created: ",t),this.emit(d,t),this.validators.forEach(e=>e.onConnectionAdded?.({outNodeId:t.outNodeId,inNodeId:t.inNodeId}))}),this.connectionManager.on(c,t=>{console.debug("Connection is clicked: ",t),this.emit(c,t),this.connectionManager.removeConnection(t)}),this.connectionManager.on(r,t=>{console.debug("Connection is removed: ",t),this.emit(r,t),this.validators.forEach(e=>e.onConnectionRemoved?.({outNodeId:t.outNodeId,inNodeId:t.inNodeId}))})}highlightCycle(t){if(t&&!(t.length<2))for(let e=0;e<t.length-1;e++){const n=this.connectionManager.connections.find(n=>n.outNodeId===t[e]&&n.inNodeId===t[e+1]);n&&this.connectionManager.markPathBad(n)}}addNode(t){return this.nodeManager.addNode(t)}mouseDownStartConnection(t,e,n){console.debug("FLOW: Start connection from port: ",t,"nodeId: ",e),n.stopPropagation(),this.isConnecting=!0,this.connectionStart={nodeId:e,index:t.dataset.index},this.connectionManager.beginTempConnection(e,t.dataset.index),this._drawConnection=n=>this.mouseMoveDrawConnection(t,e,n),this._cancelConnection=t=>this.keyDownCancelConnection(t,e),window.addEventListener("mousemove",this._drawConnection),window.addEventListener("keydown",this._cancelConnection),this.startRaf(()=>{const t=this.connectionStart.prevX==this.connectionStart.x&&this.connectionStart.prevY==this.connectionStart.y;this.connectionStart.x&&this.connectionStart.y&&!t&&(this.connectionStart.prevX=this.connectionStart.x,this.connectionStart.prevY=this.connectionStart.y,this.connectionManager.updateTempConnection(this.connectionStart.x,this.connectionStart.y))})}mouseMoveDrawConnection(t,e,n){if(this.isConnecting){this._canvasRect||(this._canvasRect=this.canvasEl.getBoundingClientRect());const t=this._canvasRect,e=(n.clientX-t.left)/this.zoom,o=(n.clientY-t.top)/this.zoom;this.connectionStart.x=e,this.connectionStart.y=o}}mouseUpCompleteConnection(t,e,n){if(this.isConnecting){const t=n.target.closest(".flow-port");if(t&&"input"===t.dataset.type){const o=parseInt(t.dataset.nodeId),i=parseInt(t.dataset.index);this.addConnection(this.connectionStart.nodeId,this.connectionStart.index,o,i,n,e)&&this.connectionManager.endTempConnection()}}}addConnection(t,e,n,o,i=null,s=null){for(const e of this.validators){const o=e.onConnectionAttempt({outNodeId:t,inNodeId:n});if(!o.valid)return this.notification?.warning(o.message),this.connectionManager.markTempPathBad(),o.stack&&this.highlightCycle(o.stack),!1}const a=this.connectionManager.addConnection(t,e,n,o);return a&&(this.validators.forEach(e=>e.onConnectionAdded?.({outNodeId:t,inNodeId:n})),i&&this.keyDownCancelConnection(i,s)),a}keyDownCancelConnection(t,e){"keydown"==t.type&&"Escape"!==t.key&&27!==t.keyCode||(this.isConnecting=!1,this.connectionManager.endTempConnection(),this._drawConnection&&(window.removeEventListener("mousemove",this._drawConnection),window.removeEventListener("keydown",this._cancelConnection),this._drawConnection=null))}removeNode(t){this.connectionManager.removeRelatedConnections(t)}export(){return this.serializer.export(this)}import(t){this.serializer.import(this,t)}startRaf(t){if(this.rafId)return;const e=()=>{if(!this.isConnecting)return cancelAnimationFrame(this.rafId),this.rafId=null,void(this._canvasRect=null);t(),this.rafId=requestAnimationFrame(e)};this.rafId=requestAnimationFrame(e)}destroy(){this.isConnecting=!1,this._drawConnection&&(window.removeEventListener("mousemove",this._drawConnection),window.removeEventListener("keydown",this._cancelConnection)),cancelAnimationFrame(this.rafId)}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
